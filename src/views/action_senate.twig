{# JS to handle dynamic content for Prosecutions & Other business #}
{% block myScripts %}
    <script type="text/javascript">
        
        $( init );
 
        function init() {
            $('div[id^="Card_"]').each(function() {
                $(this).draggable({
                    scroll:true,
                    start: function (event, ui) {
                       $(this).data("startingScrollTop",window.pageYOffset);
                    },
                    drag: function(event,ui){
                       var st = parseInt($(this).data("startingScrollTop"));
                       ui.position.top -= st;
                    },
                    cursor: 'move' ,
                    helper: 'clone'
                });
            });
            
            $('div[id^="CardSlot"]').droppable( {
                drop: handleDropEvent
            } );
        }

        function handleDropEvent( event, ui ) {
            $(event.target).find('div[id^="Card_"]').remove();
            var clonedDraggable = ui.draggable.clone();
            clonedDraggable.css({'margin-left':'0px'});
            $(this).append(clonedDraggable);
        }
        
        function testing() {
            $(".sprite-CardSlot").each(function() {
                var cardSlotID = $(this).attr("id") ;
                var cardID = $(this).find('div[id^="Card_"]').attr("id");
                alert(cardSlotID + " : " + cardID);
            });
        }

        function decompressProsecutionParameters() {
            index = compressedParameters.value.indexOf(",")+1;
            document.getElementById("parameters0").value = compressedParameters.value.substr(0,index-1) ;
            document.getElementById("parameters1").value = compressedParameters.value.substr(index) ;
        }
        
        function pickOtherBusiness() {
            document.getElementById("Concessions").style.display = "none";
            document.getElementById("LandBills").style.display = "none";
            document.getElementById("LandBill1").style.display = "none";
            document.getElementById("LandBill2").style.display = "none";
            document.getElementById("LandBill3").style.display = "none";
            document.getElementById("LandBill-2").style.display = "none";
            document.getElementById("LandBill-3").style.display = "none";
            document.getElementById("Forces").style.display = "none";
            document.getElementById("Deploy").style.display = "none";
            document.getElementById("Minor").style.display = "none";
            var typePicked = document.getElementById("type").value;
            switch(typePicked) {
                case "Concessions":
                    document.getElementById("Concessions").style.display = "block";
                    break;
                case "LandBill1":
                    document.getElementById("LandBills").style.display = "block";
                    document.getElementById("LandBill1").style.display = "block";
                    break;
                case "LandBill2":
                    document.getElementById("LandBills").style.display = "block";
                    document.getElementById("LandBill2").style.display = "block";
                    break;
                case "LandBill3":
                    document.getElementById("LandBills").style.display = "block";
                    document.getElementById("LandBill3").style.display = "block";
                    break;
                case "LandBill-2":
                    document.getElementById("LandBills").style.display = "block";
                    document.getElementById("LandBill-2").style.display = "block";
                    break;
                case "LandBill-3":
                    document.getElementById("LandBills").style.display = "block";
                    document.getElementById("LandBill-3").style.display = "block";
                    break;
                case "Forces":
                    document.getElementById("Forces").style.display = "block";
                    break;
                case "Deploy":
                    document.getElementById("Deploy").style.display = "block";
                    break;
                case "Minor":
                    document.getElementById("Minor").style.display = "block";
                    break;
            }
        }
        
        function otherBusinessParameters() {
            // For other business motions, all parameters are located in the 'parameters_container' node, they must be cleared first
            var container = document.getElementById('parameters_container');
            while (container.hasChildNodes()) {
                container.removeChild(container.lastChild);
            }
            // Then, each parameters[x] hidden element must be created, populated, and added to 'parameters_container'
            if (document.getElementById("type").value === 'Concessions') {
                var mainIndex = 0 ;
                for (var baseIndex=0; baseIndex<20; baseIndex++) {
                    if (document.getElementById('Concessions_senatorID_'+baseIndex)!==null) {
                        var SenatorID = document.getElementById('Concessions_senatorID_'+baseIndex).value;
                        if (SenatorID!=='NOBODY') {
                            var ConcessionID = document.getElementById('Concessions_id_'+baseIndex).value;
                            var input0 = document.createElement("input") ;
                            input0.type = "hidden";
                            input0.name = ("parameters["+(mainIndex*2)+"]") ;
                            input0.value = SenatorID ;
                            container.appendChild(input0) ;
                            var input1 = document.createElement("input") ;
                            input1.type = "hidden";
                            input1.name = ("parameters["+(1+mainIndex*2)+"]") ;
                            input1.value = ConcessionID ;
                            container.appendChild(input1) ;
                            mainIndex++ ;
                        }
                    }
                }
            } else if (document.getElementById("type").value === 'Forces') {
                // Create & populate the parameters. 0 to 4 are simple copies to parameters[], parameters[5] must be  a list of legion numbers separated by ','
                for (var i=0;i<6;i++) {
                    var input = document.createElement("input") ;
                    input.type = "hidden";
                    input.name = ("parameters["+i+"]") ;
                    switch(i) {
                        case 5 :
                            input.value = '' ;
                            for (var j=1; j<=25; j++) {
                                var Legion = document.getElementById('Forces_5_'+j) ;
                                if (Legion!==null) {
                                    input.value = input.value + (Legion.checked ? (input.value.length>0 ? ',' : '')+j : '') ;
                                }
                            }
                            break ;
                        default:
                            input.value = document.getElementById('Forces_'+i).value;
                            break ;
                    }
                    container.appendChild(input) ;
                }
            } else if (document.getElementById("type").value === 'Deploy') {
                var mainIndex = 0 ;
                for (var baseIndex=0; baseIndex<5; baseIndex++) {
                    Conflict = document.getElementById('Deploy_Conflict_'+baseIndex);
                    // A Conflict was selected : We need to decompress parameters.
                    if (Conflict!==null && Conflict.value!=='NONE') {
                        var LegionsParameter = document.getElementById('Deploy_Regulars_'+baseIndex).value + ',' + document.getElementById('Deploy_Veterans_'+baseIndex).value ;
                        for (var i=0; i<25; i++) {
                            var Legion = document.getElementById('Deploy_Legion_'+baseIndex+'_'+i) ;
                            if (Legion!==null) {
                                LegionsParameter=LegionsParameter+(Legion.checked ? ','+i : '') ;
                            }
                        }
                        // Create & populate the parameters
                        for (var j=0;j<=4;j++) {
                            var input = document.createElement("input") ;
                            input.type = "hidden";
                            input.name = ("parameters["+(j+mainIndex*5)+"]") ;
                            switch(j) {
                                case 0:
                                    input.value = document.getElementById('Deploy_Commander_'+baseIndex).value;
                                    break ;
                                case 1:
                                    input.value = Conflict.value ;
                                    break ;
                                case 2:
                                    input.value = LegionsParameter ;
                                    break ;
                                case 3 :
                                    input.value = document.getElementById('Deploy_Fleet_'+baseIndex).value;
                                    break ;
                                default :
                                    input.value = 'NULL' ;
                                    break ;
                            }
                            container.appendChild(input) ;
                        }
                        mainIndex++;
                    }
                }
            }
        }

    </script>
{% endblock %}

{# The view controller #}
{% set output = content['game'].senate_view(user_id) %}

{#
    Give the opportunity to slaughter other senators
#}
{% if output['assassinate']!=FALSE and (output['assassinate']|length > 0) %}
    <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_assassination'} ) }}">
        <button type="submit" class="btn-danger">ASSASSINATION !</button>
    </form>
{% endif %}
{#
    Make a Proposal
#}
{% if output['state']=='Proposal' %}

    You can make a Proposal<br>

    <form class="form-horizontal" method="POST" name="proposal" id="proposal" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_proposal'} ) }}">

        {#
            Consuls proposal
        #}
        {% if output['type']=='Consuls' %}
        Nominate for Consularship :<br>
            <input type="hidden" name="type" value="Consuls">
            <select name="parameters[0]" style="width:500px;">
                {%for senator in output['senators']%}
                <option value="{{senator['senatorID']}}">
                     {{senator['name']}} ({{senator['partyName']}})
                </option>
                {% endfor %}
            </select><br>
            AND<br>
            <select name="parameters[1]" style="width:500px;">
                {%for senator in output['senators']%}
                <option value="{{senator['senatorID']}}">
                     {{senator['name']}} ({{senator['partyName']}})
                </option>
                {% endfor %}
            </select>
            <br><br>
        {#
            Pontifex Maximus proposal
        #}
        {#
            Dictator Appointment (consuls only)
        #}
        {% elseif output['type']=='Dictator Appointment' %}
            Appoint a Dictator (the other Consul must agree) :<br>
            <input type="hidden" name="type" value="Dictator">
            <select name="parameters[0]">
                <option value="FALSE">NO</option>
                {% for senator in output['possibleDictators']%}
                    <option value="{{senator['senatorID']}}">
                        {{senator['name']}} ({{senator['party_name']}})
                    </option>
                {% endfor %}
            </select><br>
            <input type="hidden" name="parameters[1]" value="TRUE">
            <input type="hidden" name="proposalHow" value="Dictator appointed by Consuls"></input>
        {#
            Dictator proposal
        #}
        {% elseif output['type']=='Dictator' %}
            Dictator Proposal :<br>
            <input type="hidden" name="type" value="Dictator">
            <select name="parameters[0]">
                <option value="DONE">Do not propose a Dictator this turn</option>
                {#
                    Only show a list of potential ditator if the player has more than one 'proposalHow'
                    If he has only one, it should be 'Dictator proposal', giving him only the option to click 'DONE'
                #}
                {% if output['proposalHow']|length > 1 %}
                    {% for senator in output['possibleDictators']%}
                        <option value="{{senator['senatorID']}}">
                            {{senator['name']}} ({{senator['party_name']}})
                        </option>
                    {% endfor %}
                {% endif %}
            </select><br>
        {#
            Censor proposal
        #}
        {% elseif output['type']=='Censor' %}
        Nominate for Censorship :<br>
            <input type="hidden" name="type" value="Censor">
            <select name="parameters[0]" style="width:500px;">
                {%for senator in output['senators']%}
                <option value="{{senator['senatorID']}}">
                     {{senator['name']}} ({{senator['partyName']}})
                </option>
                {% endfor %}
            </select><br>
        {#
            Prosecutions
        #}
        {% elseif output['type']=='Prosecutions' %}
            Prosecutions :<br>
            <input type="hidden" name="type" value="Prosecutions">
            Prosecute :
            <select onChange="decompressProsecutionParameters();" name="compressedParameters" id="compressedParameters" style="width:750px;">
                {%for reason in output['list']%}
                <option value="{{reason['senator'].senatorID}},{{reason['reason']}}">
                     {{reason['text']}}
                </option>
                {% endfor %}
            </select><br>
            <input type="hidden" name="parameters[0]" id="parameters0">
            <input type="hidden" name="parameters[1]" id="parameters1">
            With prosecutor :
            <select name="parameters[2]">
                {%for possibleProsecutor in output['possibleProsecutors']%}
                <option value="{{possibleProsecutor['senatorID']}}">
                     {{possibleProsecutor['name']}}({{possibleProsecutor['party_name']}})
                </option>
                {% endfor %}
            </select><br>
            <input type="hidden" name="proposalHow" value="Censor"></input>
        {#
            Governors
        #}
        {% elseif output['type']=='Governors' %}
            Governorships :<br>
            <input type="hidden" name="type" value="Governors">
            {% for detail in output['list']%}
                Propose :
                <select name="parameters[{{loop.index0 * 3}}]" style="width:400px;">
                    <option>No change</option>
                    {% for possibleGovernor in output['possibleGovernors']%}
                    <option value="{{possibleGovernor['senatorID']}}">
                        {{possibleGovernor['name']}}
                        {{possibleGovernor['user_id']=='forum' ? ' who is unaligned' : ''}}
                        {{possibleGovernor['returning'] ? ' (returning)' : ''}}
                    </option>
                    {% endfor %}
                </select>
                as governor of :
                <input type="hidden" name="parameters[{{loop.index0 * 3 + 2}}]" value="{{detail['province_id']}}">
                {{detail['province_name']}}{{detail['senator_name']!=NULL ? ' (recall of ' ~ detail['senator_name'] ~ ')' : ' (currently vacant)'}}<br>
            {% endfor %}
            <br>
        {#
            Other Business
        #}
        {% elseif output['type']=='Other Business' %}
            {% if output['adjourned'] %}
                The President has adjourned the Senate but you can keep it open by puting forward a proposal<BR>
            {% endif %}
            Other Senate business :
            <select id="type" name="type" onClick="pickOtherBusiness();" style="width:400px;">
                {% for possibleproposal in output['list']%}
                    <option value="{{possibleproposal[0]}}">
                        {{possibleproposal[1]}}
                    </option>
                {% endfor %}
            </select><br><br>
            <span id="Concessions" style="display: none;">
                {% for concession in output['concessions']%}
                    Give {{concession['name']}} <input type="hidden" name="Concessions_id_{{loop.index0}}" id="Concessions_id_{{loop.index0}}" value="{{concession['id']}}">to
                    <select name="Concessions_senatorID_{{loop.index0}}" id="Concessions_senatorID_{{loop.index0}}">
                        <option value="NOBODY">Nobody</option>
                        {% for senator in output['possibleConcessionSenators']%}
                            <option value="{{senator['senatorID']}}">{{senator['name']}} ({{senator['party_name']}})</option>
                        {% endfor %}
                    </select><BR>
                {% endfor %}
            </span>
            <span id="LandBill1" style="display: none;">
                Land Bill I<BR>
            </span>
            <span id="LandBill2" style="display: none;">
                Land Bill II<BR>
            </span>
            <span id="LandBill3" style="display: none;">
                Land Bill III<BR>
            </span>
            <span id="LandBill-2" style="display: none;">
                Repeal Land Bill II<BR>
            </span>
            <span id="LandBill-3" style="display: none;">
                Repeal Land Bill III<BR>
            </span>
            <span id="LandBills" style="display: none;">
                <div class="row">
                    <div class="span3 sprite-CardSlot" id="CardSlot1">SPONSOR</div>
                    <div class="span3 sprite-CardSlot" id="CardSlot2">CO-SPONSOR</div>
                </div>
            </span>
            <span id="Forces" style="display: none;">
                Raise/Disband Forces<BR>
                <table>
                    <tr>
                        <td colspan="2">RECRUIT :</td>
                    </tr>
                    <tr>
                        <td>
                            Legions :
                            <select name="Forces_0" id="Forces_0" style="width:100px;">
                                {% for i in 0..output['legions']['totals']['recruitable']%}
                                    <option>{{i}}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            Fleets :
                            <select name="Forces_1" id="Forces_1" style="width:100px;">
                                {% for i in 0..(25-output['fleets']['total']) %}
                                    <option>{{i}}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">DISBAND :</td>
                    </tr>
                    <tr>
                        <td>
                            Regular Legions :
                            <select name="Forces_2" id="Forces_2" style="width:100px;">
                                {% for i in 0..output['legions']['totals']['Rome']['regular'] %}
                                    <option>{{i}}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            Fleets :
                            <select name="Forces_4" id="Forces_4" style="width:100px;">
                                {% for i in 0..output['fleets']['total'] %}
                                    <option>{{i}}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Veteran Legions :
                            <select name="Forces_3" id="Forces_3" style="width:100px;">
                                {% for i in 0..(output['legions']['totals']['Rome']['veteran']-output['legions']['totals']['Rome']['loyal_veteran']) %}
                                    <option>{{i}}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td></td>
                    </tr>
                    {% if output['legions']['totals']['Rome']['loyal_veteran']>0 %}
                        <tr>
                            <td colspan="2">DISBAND SPECIFIC VETERAN LEGION :</td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                {% for i in 1..25 %}
                                    {% if output['legions'][i]['location']=='Rome' and output['legions'][i]['veteran']!='NO' and output['legions'][i]['veteran']!='YES' %}
                                        <input type="checkbox" name="Forces_5_{{i}}" id="Forces_5_{{i}}">Legion {{output['legions'][i]['name']}} loyal to {{output['legions'][i]['veteran']}}
                                    {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                    {% endif %}
                </table>
            </span>
            <span id="Deploy" style="display: none;">
                Deploy Forces<BR>
                <table>
                    <tr>
                        <td>Send</td>
                        <td>to fight</td>
                        <td>regulars</td>
                        <td>veterans</td>
                        <td>fleets</td>
                        <td>Specific veterans</td>
                    </tr>
                    {% for commander in output['commanders'] %}
                        {% set ind=loop.index0 %}
                        <tr>
                            <td>
                                <input type="hidden" name="Deploy_Commander_{{ind}}" id="Deploy_Commander_{{ind}}" value="{{commander['senatorID']}}">
                                {{commander['name']}} ({{commander['office']}})
                            </td>
                            <td>
                                <select name="Deploy_Conflict_{{ind}}" id="Deploy_Conflict_{{ind}}" style="width:250px;">
                                    <option value='NONE'>Don't send</option>
                                    {% for conflict in output['conflicts'] %}
                                        <option value="{{conflict['id']}}">{{conflict['name']}} ({{conflict['land']}}/{{conflict['support']}}/{{conflict['fleet']}})</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="Deploy_Regulars_{{ind}}" id="Deploy_Regulars_{{ind}}" style="width:100px;">
                                    {% for regular in 0..output['legions']['totals']['Rome']['regular'] %}
                                        <option>{{regular}}</option>
                                    {% endfor%}
                                </select>
                            </td>
                            <td>
                                <select name="Deploy_Veterans_{{ind}}" id="Deploy_Veterans_{{ind}}" style="width:100px;">
                                    {% for veteran in 0..output['legions']['totals']['Rome']['veteran'] %}
                                        <option>{{veteran}}</option>
                                    {% endfor%}
                                </select>
                            </td>
                            <td>
                                <select name="Deploy_Fleet_{{ind}}" id="Deploy_Fleet_{{ind}}" style="width:100px;">
                                    {% for fleet in 0..output['fleets']['total'] %}
                                        <option>{{fleet}}</option>
                                    {% endfor%}
                                </select>
                            </td>
                            <td>
                                {% if output['legions']['totals']['Rome']['veteran']>0 %}
                                    {% for key, legion in output['legions']%}
                                        {% if key != 'totals' and legion['location']=='Rome' and legion['veteran']!='NO' and legion['veteran']!='YES' %}
                                            <input type="checkbox" name="Deploy_Legion_{{ind}}_{{key}}" id="Deploy_Legion_{{ind}}_{{key}}" title="Loyal to {{legion['veteran']}}"><span title="Loyal to {{legion['veteran']}}">{{legion['name']}}</span>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </span>
            <span id="Minor" style="display: none;">
                Minor motion<BR>
            </span>
            <span id="parameters_container" style="display: none;">
            </span>
            <BR>
        {% endif %}
        {#
            Show a list of possible ways to make a proposal
            Doesn't apply to prosecutions (only Censor can make proposals, and assassin prosecution is automatic) or dictator appointment by Consuls
        #}
        {% if output['type']!='Prosecutions' and output['type']!='Assassin prosecution' and output['type']!='Dictator Appointment' %}
            Choose how to make proposal :<br>
            {% embed 'action_senate_proposalHow.twig' %}
            {% endembed %}
        {% endif %}
        {#
            Choose voting order. Doesn't apply to dictator appointment by Consuls
        #}
        {% if output['type']!='Dictator Appointment' %}
            <div class="row">
                Choose voting order :<br>
                {% embed 'action_senate_votingOrder.twig' %}
                {% endembed %}
            </div>
        {% endif %}
        <br>
        <button type="submit" onClick="otherBusinessParameters();" class="btn-danger">MAKE PROPOSAL</button><BR>
        <button type="button" onClick="testing();" class="btn-danger">TEST</button>
        {#
            Once the Senate is adjourned, players must have a way to signify they don't want to keep the Senate open
        #}
        {% if output['adjourned']|default(false) %}
            <BR><BR>
            <form class="form-horizontal" method="POST">
                <button type="submit" class="btn-danger">NO MORE PROPOSALS</button>
            </form>
        {% endif %}

    </form>
    {#
        If President, can adjourn the senate
    #}
    {% if output['adjourn']|default (false) %}
        <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_adjourn'} ) }}">
            <button type="submit" class="btn-danger">ADJOURN THE SENATE</button>
        </form>
    {% endif %}
    {#
        For prosecutions : give a chance to do without
    #}
    {% if output['type']=='Prosecutions' %}
    <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_endProscutions'} ) }}">
        <button type="submit" class="btn-danger">NO MORE PROSECUTIONS</button>
    </form>
    {% endif %}
{#
    Proposal impossible
#}
{% elseif output['state']=='Proposal impossible'%}
        You cannot make a proposal at the moment<br>
        {{output['reason']|default('')}}

{#
    Assassin special prosecution : allow the Censor to chose voting order
#}
{% elseif output['state']=='Assassin prosecution voting order'%}

    {% if output['canChoose']%}
        Choose voting order :<br>
        {% embed 'action_senate_votingOrder.twig' %}
        {% endembed %}
    {% else %}
        Waiting for the Censor to decide the voting order on the special major prosecution for assassination
    {% endif %}

{#
    Vote
#}
{% elseif output['state']=='Vote'%}
    Vote - {{output['type']}}<br>
    {{output['longDescription']}}<br>
    {# Can vote #}
    {% if output['canVote']%}
    Please cast your vote:<br>
    <hr>
    {% if output['appeal'] %}
        <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_appeal'} ) }}">
            Appeal to the people (Popularity : {{output['popularity']}}) :
            <button type="submit" class="btn-danger">APPEAL</button>
        </form>
    {% endif %}
    {#
        Cast Vote as whole party
    #}
    <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_vote'} ) }}">
        Whole party vote :<br>
        <select name="wholeParty" id="wholeParty">
            <option value="1">FOR</option>
            <option value="-1">AGAINST</option>
            <option value="0" selected>ABSTAIN</option>
        </select><br>
        <button type="submit" class="btn-danger">CAST VOTE FOR WHOLE PARTY</button>
    </form>
    {#
        Cast Vote Senator per Senator
    #}
    <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_vote'} ) }}">
        Vote by Senator :<br>
        {% for voter in output['voting']%}
            {% if voter['user_id'] == user_id%}
                {{voter['name']}} ( {{voter['votes']}} votes)
                {% if voter['votes']>0 %}
                    <select name="{{voter['senatorID']}}">
                        <option value="1">FOR</option>
                        <option value="-1">AGAINST</option>
                        <option value="0" selected>ABSTAIN</option>
                    </select>
                    {% if output['treasury'][voter['senatorID']] > 0 %}
                    <select name="{{voter['senatorID']}}_talents">
                        {% for i in 0..output['treasury'][voter['senatorID']]%}
                            <option>{{i}}</option>
                        {% endfor %}
                    </select>
                    {% endif %}
                    <br>
                {% endif %}
            {% endif %}
        {% endfor%}
        <button type="submit" class="btn-danger">CAST VOTE BY SENATORS</button>
    </form>
    {#
        Veto
    #}
    {% if (output['possibleVetos']|length >0) %}
        <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_vote'} ) }}">
            Veto the proposal using :<br>
            <input type="hidden" name="useVeto" value="YES">
            <select name="veto" id="veto">
                {% for veto in output['possibleVetos'] %}
                    {% if veto=='Tribune card' %}
                        <option value="Card">Tribune Card</option>
                    {% else %}
                        <option value="{{veto['senatorID']}}">{{veto['name'] ~ '\'s free tribune.'}}</option>
                    {% endif %}
                {% endfor%}
            </select><br>
            <button type="submit" class="btn-danger">VETO</button>
        </form>
    {% endif %}
    {% else %}
    Currently voting : {{output['votingOrderNames'][0]}}<br>
    {# Cannot vote #}
    {% endif %}

{#
    A Decision has to be made (e.g. who is Consul of Rome in a Pair, Dictator appoints a MoH, etc)
#}
{% elseif output['state']=='Decision' %}
    Decision<br>
    {#
        Decision - Consuls
    #}
    {% if output['type'] =='Consuls'%}
        {% if output['canDecide']%}
            <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_decision'} ) }}">
                <input type="hidden" name="type" id="type" value="consuls">
                {% for senator in output['senator']%}
                    {% if senator=='notYou' %}
                    {% elseif senator=='alreadyDecided'%}
                        You have made your choice.<br>
                    {% else %}
                        You want {{senator.name}} to be 
                        <select name="{{senator.senatorID}}">
                            <option value="ROME">ROME CONSUL</option>
                            <option value="FIELD">FIELD CONSUL</option>
                        </select><br>
                    {% endif %}
                {% endfor %}
                <button type="submit" class="btn-danger">OK</button>
            </form>
        {% else %}
            Waiting for the elected consuls to decide between themselves
        {% endif %}
    {#
        Decision - Dictator appointment
    #}
    {% elseif output['type'] =='Dictator'%}
        {% if output['canDecide']%}
            Your fellow Consul is proposing to appoint {{output['SenatorName']}} as Dictator<br>
            <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_decision'} ) }}">
                <input type="hidden" name="type" id="type" value="AppointDictator">
                <select name="accept">
                    <option value="YES">ACCEPT</option>
                    <option value="NO">REFUSE</option>
                </select><br>
                <button type="submit" class="btn-danger">OK</button>
            </form>
        {% else %}
            Waiting for Consuls to decide if they want to appoint a dictator
        {% endif %}
    {#
        Decision - Master of Horse appointment by the dictator
    #}
    {% elseif output['type'] =='Master of horse'%}
        {% if output['canDecide']%}
            <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_decision'} ) }}">
                <input type="hidden" name="type" id="type" value="masterOfHorse">
                <select name="senator">
                    {% for senator in output['list']%}
                        <option value="{{senator['senatorID']}}">{{senator['name']}} ({{senator['party_name']}})</option>
                    {% endfor %}
                </select><br>
                <button type="submit" class="btn-danger">OK</button>
            </form>
        {% else %}
            Waiting for the Dictator to appoint his Master of Horse.
        {% endif %}
    {#
        Decision - Prosecutor
    #}
    {% elseif output['type'] =='Prosecutions'%}
        {{output['prosecutorName']}} must decide if he accepts to be the prosecutor :<br>
        {% if output['canDecide']%}
            <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_decision'} ) }}">
                <input type="hidden" name="type" id="type" value="prosecutions">
                <select name="accept">
                    <option value="YES">ACCEPT</option>
                    <option value="NO">REFUSE</option>
                </select><br>
                <button type="submit" class="btn-danger">OK</button>
            </form>
        {% else %}
            Waiting for the appointed prosecutor to decide if he accepts the appointment.
        {% endif %}
    {#
        Decision - Whether returning Governors can go again or not
    #}
    {% elseif output['type'] =='Governors'%}
        {% if output['canDecide']%}
            You have returning governor(s) ({{output['list']}}) in the current proposal. Do you agree for them to go govern a province again this turn ?<br>
            <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_decision'} ) }}">
                <input type="hidden" name="type" id="type" value="governors">
                <select name="accept">
                    <option value="YES">YES</option>
                    <option value="NO">NO</option>
                </select><br>
                <button type="submit" class="btn-danger">OK</button>
            </form>
        {% else %}
            Waiting for returning governors to decide if they agree to go govern a province again this turn.
        {% endif %}
    {#
        Decision - Whether a commander can weasel out of a Deploy proposal when there is not enough forces
    #}
    {% elseif output['type'] =='Weasel'%}
        {% if output['canDecide']%}
            A proposal involves one of your Senator to be deployed with unsufficient forces. Do you accept ?<br>
            <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_decision'} ) }}">
                <input type="hidden" name="type" id="type" value="deploy">
                <select name="accept">
                    <option value="YES">YES - Morituri te salutant</option>
                    <option value="NO">NO - Semper weaselum</option>
                </select><br>
                <button type="submit" class="btn-danger">OK</button>
            </form>
        {% else %}
            Waiting for commander to accept being deployed with unsufficient forces.
        {% endif %}
    {% else %}
    {% endif %}

{#
    Unanimous defeat of the Presiding magistrate
#}
{% elseif output['state']=='Unanimous defeat' %}
    The presiding magistrate has been unanimously defeated<br>
    {% if output['presiding'] %}
        You are presiding and must decide how to handle your unanimous defeat :<br>
        <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_stepDown'} ) }}">
        {% if output['choice']%}
            <select name="stepDown" id="stepDown" style="width:250px;">
                <option value="0">Stay president, lose 1 Influence</option>
                <option value="1">Step down</option>
            </select>
        {% else %}
            Since {{output['name']}} has 0 Influence, he must step down<br>
            <input type="hidden" name="stepDown" id="stepDown" value="1">
        {% endif %}
            <button type="submit" class="btn-danger">OK</button>
        </form>
    {% else %}
        Waiting for him to decide how to handle his unanimous defeat.<br>
    {% endif %}
{#
    Assassination interface
#}
{% elseif output['state']=='Assassination' %}
    {# Assissanitasstating player must choose assassin #}
    {% if output['subState']=='choose assassin'%}
        <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_chooseAssassin'} ) }}">
            Target of assassination :
            <select name="target" id="target" style="width:750px;">
                {% for victim in output['potentialVictims']%}
                    <option value="{{victim['senatorID']}}">{{victim['name']}} ({{victim['party_name']}})</option>
                {% endfor %}
            </select><br>
            Assassin :
            <select name="assassin" id="assassin" style="width:750px;">
                {% for assassin in output['potentialAssassins']%}
                    <option value="{{assassin['senatorID']}}">{{assassin['name']}}</option>
                {% endfor %}
            </select><br>
            {% if output['cards']|length >0%}
                <select name="card" id="card" style="width:450px;">
                    <option value="NONE">NONE</option>
                    {% for card in output['cards']%}
                        <option value="{{card['id']}}">{{card['name']}}</option>
                    {% endfor %}
                </select><br>
            {% else %}
                No assassination cards to play
                <input type="hidden" name="card" id="card" value="NONE">
            {% endif %}
            <button type="submit" class="btn-danger">VAE VICTIS</button>
        </form>
    {# Victim can play bodyguards after the roll #}
    {% elseif output['subState']=='play bodyguards'%}
        <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_playBodyguards'} ) }}">
            {% if output['cards']|length >0%}
                You can play at least one bodyguard card :<br>
                {% for card in output['cards']%}
                    <input type="checkbox" name="cards[]" id="cards[]" value="{{card['id']}}">{{card['name']}}<br>
                {% endfor %}
                <br>
                <button type="submit" class="btn-danger">TU QUOQUE MI FILII</button>
            {% else %}
                No bodyguard card(s) to play<br>
                <input type="hidden" name="cards" id="cards" value="NONE">
                <button type="submit" class="btn-danger">MORITURUS TE SALUTAT</button>
            {% endif %}
        </form>
    {# Waiting for the assassin to make up his mind #}
    {% elseif output['subState']=='waiting for assassin'%}
        Assassination : waiting for the assassin to decide.<br>
    {# Waiting for victim to play bodyguards #}
    {% else %}
        Assassination : waiting for the victim to play bodyguards.<br>
    {% endif %}
{#
    Error
#}
{% else %}
ERROR - Wrong state

{% endif %}
<script type="text/javascript">
    // Update other business span tag when pages loads according to which option is selected in the relevant <select>.
    // Only applies if such a span is avaiable. here, we test "Concessions" but any other could actually be tested (LandBill1, Minor, etc)
    if (document.getElementById("Concessions")) {
        pickOtherBusiness();
    }
    // Prosecutions : Update parameters[0] and parameters[1] from compressedParameters
    if (document.getElementById("compressedParameters")) {
        decompressProsecutionParameters();
    }
</script>
