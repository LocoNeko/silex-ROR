{# The view controller #}
{% set output = content['game'].senate_view(user_id) %}

{#
    Make a Proposal
#}
{% if output['state']=='Proposal' %}
    You can make a Proposal<br>
    <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_proposal'} ) }}">

        {#
            Consuls proposal
        #}
        {% if output['type']=='Consuls' %}
        Nominate for Consularship :<br>
            <input type="hidden" name="type" value="Consuls">
            <select name="parameters[0]" style="width:500px;">
                {%for senator in output['senators']%}
                <option value="{{senator['senatorID']}}">
                     {{senator['name']}} ({{senator['partyName']}})
                </option>
                {% endfor %}
            </select><br>
            AND<br>
            <select name="parameters[1]" style="width:500px;">
                {%for senator in output['senators']%}
                <option value="{{senator['senatorID']}}">
                     {{senator['name']}} ({{senator['partyName']}})
                </option>
                {% endfor %}
            </select>
            <br><br>
        {#
            Dictator proposal
        #}
        {% elseif output['type']=='Dictator' %}
        {#
            Censor proposal
        #}
        {% elseif output['type']=='Censor' %}
        Nominate for Censorship :<br>
            <input type="hidden" name="type" value="Censor">
            <select name="parameters[0]" style="width:500px;">
                {%for senator in output['senators']%}
                <option value="{{senator['senatorID']}}">
                     {{senator['name']}} ({{senator['partyName']}})
                </option>
                {% endfor %}
            </select><br>
        {#
        TO DO : 15 other types of proposals
        #}
        {% endif %}
            Choose how to make proposal :<br>
        {% embed 'action_senate_proposalHow.twig' %}
        {% endembed %}
        Choose voting order :<br>
        {% embed 'action_senate_votingOrder.twig' %}
        {% endembed %}
        <br>
        <button type="submit" class="btn-danger">MAKE PROPOSAL</button>
    </form>

{#
    Proposal impossible
#}
{% elseif output['state']=='Proposal impossible'%}
You cannot make a proposal at the moment
        
{#
    Vote
#}
{% elseif output['state']=='Vote'%}
    Vote - {{output['type']}}<br>
    {{output['longDescription']}}<br>
    {# Can vote #}
    {% if output['canVote']%}
    Please cast your vote:<br>
    <hr>
    <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_vote'} ) }}">
        Whole party vote :<br>
        <select name="wholeParty" id="wholeParty">
            <option value="1">FOR</option>
            <option value="-1">AGAINST</option>
            <option value="0" selected>ABSTAIN</option>
        </select><br>
        <button type="submit" class="btn-danger">CAST VOTE FOR WHOLE PARTY</button>
    </form>
    <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_vote'} ) }}">
        Vote by Senator :<br>
        {% for voter in output['voting']%}
            {% if voter['user_id'] == user_id%}
                {{voter['name']}} ( {{voter['votes']}} votes)
                {% if voter['votes']>0 %}
                    <select name="{{voter['senatorID']}}">
                        <option value="1">FOR</option>
                        <option value="-1">AGAINST</option>
                        <option value="0" selected>ABSTAIN</option>
                    </select>
                    {% if output['treasury'][voter['senatorID']] > 0 %}
                    <select name="{{voter['senatorID']}}_talents">
                        {% for i in 0..output['treasury'][voter['senatorID']]%}
                            <option>{{i}}</option>
                        {% endfor %}
                    </select>
                    {% endif %}
                    <br>
                {% endif %}
            {% endif %}
        {% endfor%}
        <button type="submit" class="btn-danger">CAST VOTE BY SENATORS</button>
    </form>
    {% else %}
    Currently voting : {{output['votingOrderNames'][0]}}<br>
    {# Cannot vote #}
    {% endif %}

{#
    A Decision has to be made (e.g. who is Consul of Rome in a Pair, Dictator appoints a MoH, etc)
#}
{% elseif output['state']=='Decision' %}
    Decision<br>
    {% if output['type'] =='Consuls'%}
        {% if output['canDecide']%}
            <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_decision'} ) }}">
                <input type="hidden" name="type" id="type" value="consuls">
                {% for senator in output['senator']%}
                    {% if senator=='notYou' %}
                    {% elseif senator=='alreadyDecided'%}
                        You have made your choice.<br>
                    {% else %}
                        You want {{senator.name}} to be 
                        <select name="{{senator.senatorID}}">
                            <option value="ROME">ROME CONSUL</option>
                            <option value="FIELD">FIELD CONSUL</option>
                        </select><br>
                    {% endif %}
                {% endfor %}
                <button type="submit" class="btn-danger">OK</button>
            </form>
        {% else %}
            Waiting for the elected consuls to decide between themselves
        {% endif %}
    {% else %}
    {% endif %}

{#
    Unanimous defeat of the Presiding magistrate
#}
{% elseif output['state']=='Unanimous defeat' %}
    The presiding magistrate has been unanimously defeated<br>
    {% if output['presiding'] %}
        You are presiding and must decide how to handle your unanimous defeat :<br>
        <form class="form-horizontal" method="POST" action="{{ path('Action' , {'game_id' : game_id , 'action' : 'senate_stepDown'} ) }}">
        {% if output['choice']%}
            <select name="stepDown" id="stepDown" style="width:250px;">
                <option value="0">Stay president, lose 1 Influence</option>
                <option value="1">Step down</option>
            </select>
        {% else %}
            Since {{output['name']}} has 0 Influence, he must step down<br>
            <input type="hidden" name="stepDown" id="stepDown" value="1">
        {% endif %}
            <button type="submit" class="btn-danger">OK</button>
        </form>
    {% else %}
        Waiting for the him to decide how to handle the unanimous defeat.<br>
    {% endif %}
{#
    Error
#}
{% else %}
ERROR - Wrong state

{% endif %}
